"use strict";$(function(t){var e,a,i=(e=new RegExp("(^|&)"+"sid"+"=([^&]*)(&|$)"),null!=(a=t.location.search.substr(1).match(e))?unescape(a[2]):null),n=$(".nav-item.nav-active").data("state"),s="none",d={sid:i,status:n,loadmore:!1};l(d=loadMoreInit(d)),$(".nav-box .nav-item").click(function(t){var e=$(t.target);if(n!==e.data("state")){r.html(""),$(".nav-item.nav-active").removeClass("nav-active"),e.addClass("nav-active"),n=e.data("state"),"wait"===n?"inline-block":"none",s="payed"===n?"none":"block";var a={sid:i,status:n,loadmore:!1};l(a=loadMoreInit(a))}});var r=$(".order-list");function l(t){api("get_order_list",t).then(function(e){if(t.status===$(".nav-item.nav-active").data("state"))if(t.loadmore||r.html(""),(e=JSON.parse(e))&&e.data){var a=e.data;checkLoadMore(a.lists.length,a.length,l),a.lists.length?function(t,e){for(var a=0;a<t.length;a++){var i=t[a];i.delivery?"block":"none";var n="1"!=i.status,d="0.00"==i.rebate?"<div></div>":'<div>返佣金额：<span class="text-red">￥'+i.rebate+"</span></div>",r=i.note?'<div class="mr-15">备注：<span>'+i.note+"</span></div>":"",l="2"==i.status?"":i.delivery?'<button data-id="'+i.id+'" class="btn btn-default btn-color btn-self js_confirm"><i class="iconfont icon-querenshouhuo f-12" aria-hidden="true"></i> 确认收货</button>':'<div class="text-p d-flex align-items-center"><i class="iconfont icon-delivery f-18" aria-hidden="true"></i> &nbsp;<span>等待配送</span></div>',o='\n      <div class="order-item">\n        <div class="order-price d-flex justify-content-between align-items-center">\n          <div class="d-flex align-items-center">\n            <div class="item-img mr-15">\n              <img src="images/order-img.png" height="60px" width="60px" alt="order img">\n            </div>\n            <div class="item-price mr-3">\n              <div>订单金额：￥'+i.money+'</div>\n              <div style="display: '+s+'">获得公益分：<i class="iconfont icon-integral2 f-14 text-yellow"></i> '+i.getwelfare+'</div>\n              <div>实际应付：<span class="text-red">￥'+i.relmoney+"</span></div>\n              "+d+'\n            \n            </div>\n          </div>\n          <div class="item-btn pr-15">\n            '+l+'\n          </div>\n        </div>\n        <div class="item-detail">\n            <div class="detail-title">\n              '+r+'\n              <div class="mr-15">订单号：'+i.trade_no+"</div> \n              <div>下单时间: "+i.create_date+'</div>\n              <div style="display: '+s+'">订单完成: '+i.update_date+'</div>\n            </div>\n            <div class="detail-text">\n  \n            </div>\n        </div>\n      </div>\n      ';e.append(o);var c=$(".order-item:last .order-price .js_confirm");n?(c.html(""),c.attr("disabled",!0)):(c.removeAttr("disabled"),c.html('<i class="iconfont icon-querenshouhuo f-12" aria-hidden="true"></i> <span data-state="wait">确认收货</span>'));for(var v=t[a].detail,m=$(".order-item:last .item-detail>.detail-text"),u=0;u<v.length;u++){var p=v[u],f='\n        <div class="item"><span class="mr-3">'+p.title+"</span> x"+p.ticket_num+"</div>\n        ";m.append(f)}}}(a.lists,r):r.append('<div class="empty-container"><p class="empty-info">订单列表为空.</p></div>')}else swal({button:"关闭",text:"获取订单列表失败，"+e.status.error_desc,type:"error"})}).catch(function(t){swal({button:"关闭",text:"获取订单列表失败, 请检查网络"})})}$(".order-list").on("click",".js_confirm",function(t){var e=$(t.target);e.is("span")&&(e=e.parent(".js_confirm"));var a=e.data("id");e.find("span").data("state");!function(t){if(o)return;o=!0,api("get_order_update",t).then(function(t){if(1===(t=JSON.parse(t)).status.succeed){$(".nav-item.nav-active").removeClass("nav-active"),$(".nav-item.nav-finish").addClass("nav-active"),n="finish",r.html(""),"none",s="block";var e={sid:i,status:"finish"};l(e=loadMoreInit(e))}1!==t.status.succeed&&swal({button:"关闭",text:"订单确认失败,"+t.status.error_desc,type:"error"})}).catch(function(t){console.error("1",t),swal({button:"关闭",text:"订单确认失败，请检查网络！"})}).then(function(){o=!1})}({id:a,sid:i})});var o=!1;t.sid=i,t.active_menu="indent"}(window));