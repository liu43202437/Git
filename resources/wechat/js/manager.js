"use strict";$(function(){var e={sid:"47eccd96f3a5199018538298e5e7b50e",phone:"",id_number:"",manager_name:"",area_id:"",city:"",address:"",area_code:"",id:"",type:"bazaar_manager",update:!1,phoneCode:!1};function n(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(n);return null!=a?unescape(a[2]):null}e.sid=n("sid");var a=$(".manager-name-txt"),r=$(".manager-name"),t=/^[\u4e00-\u9fa5]{2,4}$/;function o(){return t.test(a.val())?(r.children("span").addClass("glyphicon-ok green"),e.manager_name=a.val(),!0):(r.children("span").addClass("glyphicon-remove red"),!1)}a.focus(function(){r.children("span").removeClass("glyphicon-remove red glyphicon-ok green")}),a.blur(o);var l=$(".area-manager-name-txt"),i=$(".area-manager-name");l.focus(function(){i.children("span").removeClass("glyphicon-remove red glyphicon-ok green")}),l.blur(function(){return t.test(l.val())?(i.children("span").addClass("glyphicon-ok green"),e.area_managername=l.val(),!0):(i.children("span").addClass("glyphicon-remove red"),!1)});var s=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,d=$(".id-num"),c=$(".id-number");function u(){return s.test(d.val())?(c.children("span").addClass("glyphicon-ok green"),e.id_number=d.val(),!0):(c.children("span").addClass("glyphicon-remove red"),!1)}d.focus(function(){c.children("span").removeClass("glyphicon-remove red glyphicon-ok green")}),d.blur(u);var p=/^1[34578]\d{9}$/,h=$(".area-id-num"),m=$(".area-id-number");h.blur(function(){return p.test(h.val())?(m.children("span").addClass("glyphicon-ok green"),e.area_managerid=h.val(),!0):(m.children("span").addClass("glyphicon-remove red"),!1)}),h.focus(function(){m.children("span").removeClass("glyphicon-remove red glyphicon-ok green")});var v=CITY_CODE,g=new MobileSelect({trigger:"#province",title:"请选择地区",wheels:[{data:v}],position:[2],transitionEnd:function(e,n){},callback:function(n,a){e.area_id=a[0]?a[0].id:"",e.city=a[1]?a[1].value:"";var r=a[2]?a[2].value:"",t=a[3]?a[3].value:"";e.address=r+t,e.area_code=a[a.length-1].id}}),b=/^1[34578]\d{9}$/,f=$(".phone-num"),y=$(".phone"),C=$(".msgs");function w(){return f.val()&&b.test(f.val())?(y.children("span").addClass("glyphicon-ok green"),!0):(y.children("span").addClass("glyphicon-remove red"),!1)}f.focus(function(){y.children("span").removeClass("glyphicon-remove red glyphicon-ok green")}),f.blur(w),f.on("input propertychange",function(){C.text("点击获取验证码"),b.test($(this).val())?(C.removeClass("disable-btn").addClass("able-btn"),e.phoneCode=!0,e.phone=f.val()):(C.removeClass("able-btn").addClass("disable-btn"),e.phoneCode=!1)});var x=null;C.click(function(){if(e.phoneCode){if(x)return;var n=60;C.text(n+"s后重新获取"),x=window.setInterval(function(){n--,C.text(n+"s后重新获取"),n<0&&(C.text("获取验证码"),C.prop("disabled",!1),window.clearInterval(x),x=null)},1e3),apiType({type:"POST",timeout:5e3},"ajaxSend",{mobile:e.phone}).then(function(e){(e=JSON.parse(e)).success||(swal({button:"关闭",text:""+e.error,type:"error"}),C.text("获取验证码"),window.clearInterval(x),x=null,C.prop("disabled",!1))}).catch(function(){swal({button:"关闭",text:"网络连接异常，请稍后重试",type:"error"}),C.text("获取验证码"),window.clearInterval(x),x=null,C.prop("disabled",!1)})}});var _=$(".msg-num"),k=!1;new EditInfo({type:"manager",map:{manager_name:"name"},eleArr:[{".manager-name-txt":"manager_name"},{".id-num":"id_number"},{".phone-num":"phone"}],address:{ele:"#province",selectedObj:g,list:CITY_CODE}}).update(e),$("#sub-btn-manager").click(function(){var a=o(),r=u(),t=w();if(6===_.val().length&&a&&r&&t){e.code=_.val();var l=!$("#province").text().includes("请选择地区")||(swal({button:"关闭",text:"请选择地区"}),!1);if(k||!l)return;k=!0;var i=n("refuse");apiByObj("1"===i?{path:"/mobile/Register/",service:"modifyInfo",data:e}:{path:"/mobile/wechat/",service:"addManager",data:e}).then(function(n){1===(n=JSON.parse(n)).status.succeed?swal({button:"确定",text:"信息提交成功，请您耐心等待审核！"}).then(function(){Router.navigate("/resources/wechat/managerinfo.html",{sid:e.sid})}):swal({button:"关闭",text:"注册失败，请检查信息！"+n.status.error_desc,type:"error"})}).catch(function(){swal({button:"关闭",text:"注册失败，请检查网络！"})}).then(function(){k=!1})}else swal({button:"关闭",text:"输入有误，请重新输入！"})})});