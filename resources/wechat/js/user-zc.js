"use strict";$(function(){var e,n,a={sid:"47eccd96f3a5199018538298e5e7b50e",user_name:"",user_phone:"",code:"",shop_name:"",shop_phone:""};a.sid=(e=new RegExp("(^|&)"+"sid"+"=([^&]*)(&|$)"),null!=(n=window.location.search.substr(1).match(e))?unescape(n[2]):null);var r=/^[\u4e00-\u9fa5]{2,4}$/,t=$(".name-txt"),s=$(".name");function l(){return r.test(t.val())?(s.children("span").addClass("glyphicon-ok green"),a.user_name=t.val(),!0):(s.children("span").addClass("glyphicon-remove red"),!1)}t.focus(function(){s.children("span").removeClass("glyphicon-remove red glyphicon-ok green")}),t.blur(l);var o=$(".manager-name-txt"),i=$(".manager-name");function c(){return r.test(o.val())?(i.children("span").addClass("glyphicon-ok green"),a.shop_name=o.val(),!0):(i.children("span").addClass("glyphicon-remove red"),!1)}o.focus(function(){i.children("span").removeClass("glyphicon-remove red glyphicon-ok green")}),o.blur(c);var d=/^1[34578]\d{9}$/,u=$(".area-id-num"),p=$(".area-id-number");function h(){return d.test(u.val())?(p.children("span").addClass("glyphicon-ok green"),a.shop_phone=u.val(),!0):(p.children("span").addClass("glyphicon-remove red"),!1)}u.blur(h),u.focus(function(){p.children("span").removeClass("glyphicon-remove red glyphicon-ok green")});var v=/^1[34578]\d{9}$/,m=!1,g=$(".phone"),b=$(".phone-num"),f=$(".msgs");function y(){return b.val()&&v.test(b.val())?(g.children("span").addClass("glyphicon-ok green"),a.user_phone=b.val(),!0):(g.children("span").addClass("glyphicon-remove red"),!1)}b.focus(function(){g.children("span").removeClass("glyphicon-remove red glyphicon-ok green")}),b.blur(y),b.on("input propertychange",function(){f.text("点击获取验证码"),v.test($(this).val())?(f.removeClass("disable-btn").addClass("able-btn"),m=!0,a.user_phone=b.val()):(f.removeClass("able-btn").addClass("disable-btn"),a.user_phone="",m=!1)});var w=null;w&&(window.clearInterval(w),w=null,f.prop("disabled",!1)),f.click(function(){if(m){if(w)return;var e=60;f.text(e+"s后重新获取"),w=window.setInterval(function(){e--,f.text(e+"s后重新获取"),e<0&&(f.text("获取验证码"),f.prop("disabled",!1),window.clearInterval(w),w=null)},1e3),apiType({type:"POST",timeout:5e3},"ajaxSend",{mobile:a.user_phone}).then(function(e){(e=JSON.parse(e)).success||(swal({button:"关闭",text:""+e.error,type:"error"}),f.text("获取验证码"),window.clearInterval(w),w=null,f.prop("disabled",!1))}).catch(function(){swal({button:"关闭",text:"网络连接异常，请稍后重试",type:"error"}),f.text("获取验证码"),window.clearInterval(w),w=null,f.prop("disabled",!1)})}});var C=$(".msg-num"),x=!1;$("#sub-btn-shop").click(function(){var e=l(),n=c(),r=y(),t=h();if(6===C.val().length&&e&&n&&r&&t){if(a.code=C.val(),x)return;x=!0,apiByObj({service:"clubClanRegister",path:"/mobile/Register/",data:a}).then(function(e){0===(e=JSON.parse(e)).code?swal({button:"关闭",text:"注册成功"}).then(function(e){Router.navigate("/resources/wechat/scan-qr-code/scan-qr-code.html",{sid:a.sid})}):swal({button:"关闭",text:"注册失败，"+e.msg})}).catch(function(e){swal({button:"关闭",text:"注册失败，请检查网络！"})}).then(function(){x=!1})}else swal({button:"关闭",text:"信息不完整，请完善信息"})})});