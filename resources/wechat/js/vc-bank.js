"use strict";Vue.component("bind-bank",{template:'\n    <div>\n    <div v-if="codeID === \'14\'" class="notes">\n      <svg xmlns="http://www.w3.org/2000/svg" style="height:15px;fill:#F29A76" viewBox="0 0 512 512"><path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"/></svg>\n      <span class="pl-5"> 销售佣金返还银行卡信息绑定</span>\n    </div>\n      <div v-for="item in peoData">\n        <div v-if="item.type === \'text\'">\n          <div class="lists">\n            <div class="lab">{{item.lab}}：</div>\n            <div class="value">\n              {{item.value}}\n            </div>\n          </div>\n        </div>\n        <div v-if="item.type === \'input\'">\n          <list-item :item="item"></list-item>\n        </div>\n        <div v-if="item.type === \'select\'">\n          <mobile-select :info="item.info" :list="item.list" :init="item.initData" @selectChange="selectChange($event,item)"></mobile-select>\n        </div>\n      </div>\n      <div class="check-box" v-if="codeID !==\'14\'">\n        <input class="agree-checkbox" type="checkbox" name="agree" v-model="agreeCheck">\n        <span class="ml-5 open-model">我已阅读并同意\n          <span style=" color: #2A6853;" @click="openAgreement">《银行代扣款协议》</span>\n        </span>\n      </div>\n      <div class="model-box" v-if="isOpen" :style= "{ height:pageHeight+ \'px\' }">\n        <agreements-bank :id="codeID" :pageHeight="pageHeight" @close="closeAgreement"></agreements-bank>\n      </div>\n      <div class="mt-30">\n        <button class="sub-btn" @click="submit">下一步</button>\n      </div>\n    </div>\n  ',data:function(){return{peoData:[{type:"text",lab:"持卡人",value:""},{type:"select",info:{lab:"开户行地区",title:"请选择开户行所在地区",id:"area"},initData:{id:""},list:CITY_CODE,selectItem:null},{type:"select",info:{lab:"银行",title:"请选择开户行类型",id:"banks"},initData:{id:""},list:[{id:"1026",value:"中国银行"}],selectItem:null},{type:"select",info:{lab:"开户行",title:"请选择开户行",id:"childBanks"},initData:{id:"",value:""},list:[{id:"null",value:"暂无银行信息"}],selectItem:null},{type:"input",lab:"银行卡号",value:"",show:!1,verifyFn:function(t){return!!/\d{15,19}/.test(t)}}],codeID:"",submitting:!1,errText:"信息填写有误",refuse:"0",cityID:"",bankID:"",isGetBank:!1,pageHeight:"",isOpen:!1,agreeCheck:!1}},created:function(){this.pageHeight=this.$root.$el.parentElement.parentElement.clientHeight;var t=axiosUrlParams("name");this.peoData[0].value=unescape(t),this.codeID=axiosUrlParams("code"),this.refuse=axiosUrlParams("refuse"),"1"===this.refuse&&this.getinfo(),this.getBankNames()},methods:{openAgreement:function(){this.isOpen=!0},closeAgreement:function(){this.isOpen=!1},getinfo:function(){var t=this;apiRequest("/app/lottery/send_lotteryinfo").then(function(e){1==e.status.succeed&&e.data&&"1"===e.data.refuse&&(t.refuse="1",t.peoData[2].value=e.data.bank_card_id||"")}).catch(function(t){swal({button:"关闭",text:"信息获取失败,请联系客服"})})},selectChange:function(t,e){console.log(t),e.selectItem=t,"area"===e.info.id&&(this.isGetBank=!0,this.cityID=t.code),"banks"===e.info.id&&(this.bankID=t.code,this.isGetBank=!0),"childBanks"===e.info.id&&(this.isGetBank=!1),this.cityID&&this.bankID&&this.isGetBank&&this.getBanks(this.cityID,this.bankID)},getBankNames:function(){var t=this;apiRequest("/public/Common/getBankList").then(function(e){e.data&&e.data.length&&(t.peoData[2].list=e.data)}).catch(function(t){return console.log(t)})},getBanks:function(t,e){var i=this,n={city_id:t,bank_id:e};i.peoData[3].selectItem=null,apiRequest("/public/Common/getBankChilds",n).then(function(t){0==t.code&&(i.peoData[3].list=t.data),console.log(t)}).catch(function(t){console.log(t)})},submit:function(){if("14"===this.codeID||this.agreeCheck){var t=this;if(!this.submitting){this.submitting=!0;var e={name:this.peoData[0].value,bank_areaCode:this.peoData[1].selectItem?this.peoData[1].selectItem.code:"",bank_id:this.peoData[2].selectItem?this.peoData[2].selectItem.code:"",bank_name:this.peoData[3].selectItem?this.peoData[3].selectItem.data[0].value:"",bank_card_id:this.peoData[4].value||""};if(!e.bank_areaCode)return swal({button:"关闭",text:"请选择地区!"}),void(this.submitting=!1);if(!e.bank_id)return swal({button:"关闭",text:"请选择银行!"}),void(this.submitting=!1);if(!e.bank_name)return swal({button:"关闭",text:"请选择开户行!"}),void(this.submitting=!1);if(!/\d{13,19}/.test(e.bank_card_id))return swal({button:"关闭",text:"银行卡号填写有误!"}),this.peoData[4].show=!0,void(this.submitting=!1);apiRequest("/mobile/Register/bindBankCard",e).then(function(e){0==e.code?Router.navigateWithSid("/resources/wechat/question."+t.codeID+".html",{}):swal({button:"关闭",text:"#"+e.code+": 注册失败，请检查信息！"+e.msg})}).catch(function(t){swal({button:"关闭",text:"注册失败，请检查网络！"}),console.log(t)}).then(function(){t.submitting=!1})}}else swal({button:"关闭",text:"请阅读并同意《银行代扣款协议》!"})}}});