"use strict";Vue.component("load-img",{template:'\n  <div class="load-box">\n      <div class="background-img">\n        <img src="images/zc-bg.png" alt="">\n      </div>\n      <div class="load-img-box">\n          <div class="img-position" v-for="item in imgArr" >\n            <div class="img-container">\n              <img  width="100%" :src="item.bg_src" alt="">\n              <input type="file"  accept="image/*" @change="loadFile($event,item)" />\n            </div>\n          </div>\n      </div>\n\n      <div class="mt-20">\n        <button  @click="nextStep" class="sub-btn">去填写</button>\n      </div>\n\n      <div v-if="loading" class="loading-box">\n          <div class="loaders">\n            <div class="loader">\n              <div class="loader-inner ball-pulse">\n                <div></div>\n                <div></div>\n                <div></div>\n              </div>\n            </div>\n          </div>  \n        <div>\n          图片正在上传\n        </div>\n      </div>\n    </div>\n  ',data:function(){return{imgArr:[{name:"front",bg_src:"images/zc-front.png",src:"",type:"id_number"},{name:"back",bg_src:"images/zc-back.png",src:"",type:"id_number"},{name:"yan_code",bg_src:"images/zc-yan.png",src:"",type:"yan_code"}],loading:!1,refuse:""}},created:function(){this.initImgArrData(),this.refuse=axiosUrlParams("refuse")},methods:{initImgArrData:function(){var t=this;apiRequest("/mobile/Register/getClubImage").then(function(e){0===e.code&&(e.data.front&&(t.imgArr[0].src=t.imgArr[0].bg_src=e.data.front),e.data.back&&(t.imgArr[1].src=t.imgArr[1].bg_src=e.data.back),e.data.yan_image&&(t.imgArr[2].src=t.imgArr[2].bg_src=e.data.yan_image))}).catch(function(t){console.log(t)})},nextStep:function(){var t={},e=!0,a=!1,i=void 0;try{for(var n,r=this.imgArr[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var s=n.value;if(!s.src)return void swal({button:"关闭",text:"请完成照片上传！"});t[s.name]=s.src}}catch(t){a=!0,i=t}finally{try{!e&&r.return&&r.return()}finally{if(a)throw i}}var o=this;apiRequest("/mobile/Register/uploadClubImage",t).then(function(t){0===t.code?Router.navigateWithSid("/resources/app/shopzc.html",{refuse:o.refuse}):swal({button:"关闭",text:t.mag})}).catch(function(t){console.log(t),swal({button:"关闭",text:"信息提交失败,请联系客服"})})},loadFile:function(t,e){var a="",i=t.target.files[0];if(i){this.loading=!0;var n=new FileReader;n.readAsDataURL(i);var r=this;n.onloadend=function(){a=n.result,i.size/1024/1024>1?r.compressImage(a,{width:1240},e):r.uploadImage(a,e)}}},uploadImage:function(t,e){var a={type:e.type,base64:encodeURIComponent(t)},i=this;apiRequest("/mobile/Register/uploadBase64",a).then(function(a){a.data?(e.bg_src=t,e.src=a.data):(e.src="",swal({button:"关闭",text:"图片上传失败,"+a.msg})),i.loading=!1}).catch(function(t){e.src="",swal({button:"关闭",text:"图片上传失败,请联系客服"}),i.loading=!1,console.log(t)})},compressImage:function(t,e,a){var i=this,n=new Image;n.src=t,n.onload=function(){var t=this,n=t.width,r=t.height,s=n/r;n=e.width||n,r=e.height||n/s;var o=.8,c=document.createElement("canvas"),d=c.getContext("2d"),l=document.createAttribute("width");l.nodeValue=n;var g=document.createAttribute("height");g.nodeValue=r,c.setAttributeNode(l),c.setAttributeNode(g),d.drawImage(t,0,0,n,r),e.quality&&e.quality<=1&&e.quality>0&&(o=e.quality);var u=c.toDataURL("image/jpeg",o);i.uploadImage(u,a)}}}});