"use strict";$(function(){var e={sid:"47eccd96f3a5199018538298e5e7b50e",phone:"",id_number:"",manager_id_number:"",name:"",yan_code:"",area_id:"",area_code:"",city:"",address:"",view_name:"",manager_name:"",id:"",type:"club",update:!1,phoneCode:!1},n=/\s+/g;function a(e){var n=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(n);return null!=a?unescape(a[2]):null}e.sid=a("sid"),$(".open-model").click(function(){var e=document.documentElement.clientHeight;$(".model-box").height(e),$(".model-box").removeClass("hidden")}),$(".close-model").click(function(){$(".model-box").addClass("hidden")});var r=/^[\u4e00-\u9fa5]{2,4}$/,l=$(".name-txt"),t=$(".name");function o(){return r.test(l.val())?(t.children("span").addClass("glyphicon-ok green"),e.name=l.val(),!0):(t.children("span").addClass("glyphicon-remove red"),!1)}l.focus(function(){t.children("span").removeClass("glyphicon-remove red glyphicon-ok green")}),l.blur(o);var i=$(".manager-name-txt"),d=$(".manager-name");i.focus(function(){d.children("span").removeClass("glyphicon-remove red glyphicon-ok green")}),i.blur(function(){return r.test(i.val())?(d.children("span").addClass("glyphicon-ok green"),e.manager_name=i.val(),!0):(d.children("span").addClass("glyphicon-remove red"),!1)});var s=$(".xuke-txt"),c=$(".xuke");function u(){return""===s.val()||null===s.val()||n.test(s.val())?(c.children("span").addClass("glyphicon-remove red"),!1):(c.children("span").addClass("glyphicon-ok green"),e.yan_code=s.val(),!0)}s.focus(function(){c.children("span").removeClass("glyphicon-remove red glyphicon-ok green")}),s.blur(u);var p=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/,h=$(".id-num"),m=$(".id-number");function v(){return p.test(h.val())?(m.children("span").addClass("glyphicon-ok green"),e.id_number=h.val(),!0):(m.children("span").addClass("glyphicon-remove red"),!1)}h.blur(v),h.focus(function(){m.children("span").removeClass("glyphicon-remove red glyphicon-ok green")});var g=/^1[34578]\d{9}$/,f=$(".area-id-num"),b=$(".area-id-number");f.blur(function(){return g.test(f.val())?(b.children("span").addClass("glyphicon-ok green"),e.manager_id_number=f.val(),!0):(b.children("span").addClass("glyphicon-remove red"),!1)}),f.focus(function(){b.children("span").removeClass("glyphicon-remove red glyphicon-ok green")});var y=CITY_CODE,_="",C=new MobileSelect({trigger:"#province",title:"请选择地区",wheels:[{data:y}],position:[2],transitionEnd:function(e,n){},callback:function(n,a){console.log(a),e.area_id=a[0]?a[0].id:"";a[0]&&a[0].value;e.city=a[1]?a[1].value:"";var r=a[2]?a[2].value:"",l=a[3]?a[3].value:"";_=r+l,e.area_code=a[a.length-1].id,E=[{id:"1"}],"7"===e.area_id?$(".check-box").removeClass("hidden"):$(".check-box").addClass("hidden"),j(),O()}}),x="",w=$(".shop-ads-txt"),k=$(".shop-ads");function S(){return""===w.val()||null===w.val()||n.test(w.val())?(k.children("span").addClass("glyphicon-remove red"),!1):(k.children("span").addClass("glyphicon-ok green"),x=w.val(),!0)}w.focus(function(){k.children("span").removeClass("glyphicon-remove red glyphicon-ok green")}),w.blur(S);var I=new MobileSelect({trigger:"#managerSelected",title:"请选择",wheels:[{data:[{id:"1",value:"暂无人员信息"}]}],position:[0],callback:function(e,n){E=n,j()}});function O(n){var a=n||e.area_code;apiByObj({path:"/mobile/msgtip/",service:"get_manager_list",data:{sid:e.sid,area_code:a,type:"manager"}}).then(function(n){var a=[{id:"1",value:"暂无人员信息"}];if((n=JSON.parse(n)).data&&n.data.length){a=[];var r=!0,l=!1,t=void 0;try{for(var o,i=n.data[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var d=o.value;a.push({id:d.phone,value:d.name+" ("+d.phone+")",name:d.name})}}catch(e){l=!0,t=e}finally{try{!r&&i.return&&i.return()}finally{if(l)throw t}}}if(I.updateWheel(0,a),e.manager_id_number){var s=a.findIndex(function(n){return n.id===e.manager_id_number});s>-1?(E=[a[s]],$("#managerSelected").html(a[s].value),I.locatePosition(0,s)):$("#managerSelected").html("<p>请选择</p>")}else $("#managerSelected").html("<p>请选择</p>")})}var E=[{id:"1"}];function j(){return"1"!==E[0].id?(e.manager_name=E[0].name,e.manager_id_number=E[0].id,!0):(e.manager_name="",e.manager_id_number="",!1)}var D=$(".shop-name"),R=$(".view_name");function T(){return""===D.val()||null===D.val()||n.test(D.val())?(R.children("span").addClass("glyphicon-remove red"),!1):(e.view_name=D.val(),R.children("span").addClass("glyphicon-ok green"),!0)}D.focus(function(){R.children("span").removeClass("glyphicon-remove red glyphicon-ok green")}),D.blur(T);var A=/^1[34578]\d{9}$/,J=$(".phone"),N=$(".phone-num"),W=$(".msgs");function B(){return N.val()&&A.test(N.val())?(J.children("span").addClass("glyphicon-ok green"),e.phone=N.val(),!0):(J.children("span").addClass("glyphicon-remove red"),!1)}N.focus(function(){J.children("span").removeClass("glyphicon-remove red glyphicon-ok green")}),N.blur(B),N.on("input propertychange",function(){W.text("点击获取验证码"),A.test($(this).val())?(W.removeClass("disable-btn").addClass("able-btn"),e.phoneCode=!0,e.phone=N.val()):(W.removeClass("able-btn").addClass("disable-btn"),e.phone="",e.phoneCode=!1)});var M=null;M&&(window.clearInterval(M),M=null,W.prop("disabled",!1)),W.click(function(){if(console.log("asdfdsaf"),e.phoneCode){if(M)return;var n=60;W.text(n+"s后重新获取"),M=window.setInterval(function(){n--,W.text(n+"s后重新获取"),n<0&&(W.text("获取验证码"),W.prop("disabled",!1),window.clearInterval(M),M=null)},1e3),apiType({type:"POST",timeout:5e3},"ajaxSend",{mobile:e.phone}).then(function(e){(e=JSON.parse(e)).success||(swal({button:"关闭",text:""+e.error,type:"error"}),W.text("获取验证码"),window.clearInterval(M),M=null,W.prop("disabled",!1))}).catch(function(){swal({button:"关闭",text:"网络连接异常，请稍后重试",type:"error"}),W.text("获取验证码"),window.clearInterval(M),M=null,W.prop("disabled",!1)})}});var P=$(".msg-num"),Y=new EditInfo({type:"club",map:{manager_id_number:"manager_id"},eleArr:[{".name-txt":"name"},{".xuke-txt":"yan_code"},{".id-num":"id_number"},{".shop-name":"view_name"},{".phone-num":"phone"}],address:{ele:"#province",detail:".shop-ads-txt",selectedObj:C,list:CITY_CODE},manager:{ele:"#managerSelected",getList:O}});Y.update(e);var q=!1;$("#sub-btn-shop").click(function(){var n=o(),r=u(),l=v(),t=S(),i=B(),d=T(),s=(j(),$(".agree-checkbox").prop("checked"));if("7"!==e.area_id||s)if(6===P.val().length&&n&&r&&l&&t&&i&&d)if($("#province").text().includes("请选择地区"))swal({button:"关闭",text:"请选择地区"});else{if(e.code=P.val(),q)return;q=!0,_=_||(Y.selectData.cityAddress?Y.selectData.cityAddress:""),e.address=_+x;var c=a("refuse");apiByObj("1"===c?{path:"/mobile/Register/",service:"modifyInfo",data:e}:{path:"/mobile/wechat/",service:"updateShop",data:e}).then(function(n){1===(n=JSON.parse(n)).status.succeed?"14"===e.area_id?Router.navigateWithSid("/resources/app/vc-bank.html",{name:escape(e.name),refuse:c}):Router.navigateWithSid("/resources/app/question.html",{}):swal({button:"关闭",text:"#"+n.status.error_code+": 注册失败，请检查信息！"+n.status.error_desc})}).catch(function(e){swal({button:"关闭",text:"注册失败，请检查网络！"})}).then(function(){q=!1})}else swal({button:"关闭",text:"信息不完整，请完善信息！"});else swal({button:"关闭",text:"请阅读并同意《卷烟零售户公益票代销协议》"})})});