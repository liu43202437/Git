"use strict";Vue.component("bind-bank",{template:'\n    <div>\n      <div v-for="item in peoData">\n        <div v-if="item.type === \'text\'">\n          <div class="lists">\n            <div class="lab">{{item.lab}}：</div>\n            <div class="value">\n              {{item.value}}\n            </div>\n          </div>\n        </div>\n        <div v-if="item.type === \'input\'">\n          <list-item :item="item"></list-item>\n        </div>\n        <div v-if="item.type === \'select\'">\n          <mobile-select :info="item.info" :list="item.list" :init="item.initData" @selectChange="selectChange($event,item)"></mobile-select>\n        </div>\n      </div>\n      <div class="check-box">\n        <input class="agree-checkbox" type="checkbox" name="agree" v-model="agreeCheck">\n        <span class="ml-5 open-model">我已阅读并同意\n          <span style=" color: #2A6853;">《银行代扣款协议》</span>\n        </span>\n      </div>\n      <div class="mt-30">\n        <button class="sub-btn" @click="submit">下一步</button>\n      </div>\n    </div>\n  ',data:function(){return{peoData:[{type:"text",lab:"持卡人",value:""},{type:"select",info:{lab:"开户行地区",title:"请选择开户行所在地区",id:"area"},initData:{id:""},list:CITY_CODE,selectItem:null},{type:"select",info:{lab:"银行",title:"请选择开户行类型",id:"banks"},initData:{id:""},list:[{id:"1026",value:"中国银行"},{id:"1002",value:"中国工商银行"},{id:"1003",value:"中国建设银行"},{id:"1005",value:"中国农业银行"},{id:"1020",value:"交通银行"}],selectItem:null},{type:"select",info:{lab:"开户行",title:"请选择开户行",id:"childBanks"},initData:{id:"",value:""},list:[{id:"null",value:"暂无银行信息"}],selectItem:null},{type:"input",lab:"银行卡号",value:"",show:!1,verifyFn:function(t){return!!/\d{15,19}/.test(t)}}],codeID:"",submitting:!1,errText:"信息填写有误",refuse:"0",agreeCheck:!1,cityID:"",bankID:"",isGetBank:!1}},created:function(){var t=axiosUrlParams("name");this.peoData[0].value=unescape(t),this.codeID=axiosUrlParams("code"),this.refuse=axiosUrlParams("refuse"),"1"===this.refuse&&this.getinfo()},methods:{getinfo:function(){var t=this;apiRequest("/app/lottery/send_lotteryinfo").then(function(e){1===e.status.succeed&&e.data&&"1"===e.data.refuse&&(t.refuse="1",t.peoData[2].value=e.data.bank_card_id||"")}).catch(function(t){swal({button:"关闭",text:"信息获取失败,请联系客服"})})},selectChange:function(t,e){console.log(t),e.selectItem=t,"area"===e.info.id&&(this.isGetBank=!0,this.cityID=t.code),"banks"===e.info.id&&(this.bankID=t.code,this.isGetBank=!0),"childBanks"===e.info.id&&(this.isGetBank=!1),this.cityID&&this.bankID&&this.isGetBank&&this.getBanks(this.cityID,this.bankID)},getBanks:function(t,e){var i=this,a={city_id:t,bank_id:e};i.peoData[3].selectItem=null,apiRequest("/public/Common/getBankChilds",a).then(function(t){0===t.code&&(i.peoData[3].list=t.data),console.log(t)}).catch(function(t){console.log(t)})},submit:function(){if(this.agreeCheck){var t=this;if(!this.submitting){this.submitting=!0;var e={name:this.peoData[0].value,bank_areaCode:this.peoData[1].selectItem?this.peoData[1].selectItem.code:"",bank_id:this.peoData[2].selectItem?this.peoData[2].selectItem.code:"",bank_name:this.peoData[3].selectItem?this.peoData[3].selectItem.data[0].value:"",bank_card_id:this.peoData[4].value||""};if(!e.bank_areaCode)return swal({button:"关闭",text:"请选择地区!"}),void(this.submitting=!1);if(!e.bank_id)return swal({button:"关闭",text:"请选择银行!"}),void(this.submitting=!1);if(!e.bank_name)return swal({button:"关闭",text:"请选择开户行!"}),void(this.submitting=!1);if(!/\d{13,19}/.test(e.bank_card_id))return swal({button:"关闭",text:"银行卡号填写有误!"}),this.peoData[4].show=!0,void(this.submitting=!1);apiRequest("/mobile/Register/bindBankCard",e).then(function(e){0===e.code?Router.navigateWithSid("/resources/app/question."+t.codeID+".html",{}):swal({button:"关闭",text:"#"+e.code+": 注册失败，请检查信息！"+e.msg})}).catch(function(t){swal({button:"关闭",text:"注册失败，请检查网络！"}),console.log(t)}).then(function(){t.submitting=!1})}}else swal({button:"关闭",text:"请阅读并同意《银行代扣款协议》!"})}}});