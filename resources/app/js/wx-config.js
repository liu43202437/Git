"use strict";var loadBox=$(".js-load-box"),loadText=$(".load-text");function wxConfig(a){var o=a.appid,e=a.ticket,t=parseInt((new Date).valueOf()/1e3),d=function(a){for(var o="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",e=[],t=0;t<a;t++){var d=o.substr(parseInt(Math.random()*o.length),1);e.push(d)}return e.join("")}(16),n="jsapi_ticket="+e+"&noncestr="+d+"&timestamp="+t+"&url="+window.location.href.split("#")[0],i=$.sha1(n);wx.config({debug:!1,appId:o,timestamp:t,nonceStr:d,signature:i,jsApiList:["scanQRCode","chooseImage","previewImage","uploadImage","downloadImage"]})}loadBox&&(loadBox.addClass("loading"),loadText.text("正在加载...")),apiByObj({service:"getTicket",path:"/mobile/Js_interface/"}).then(function(a){a&&(wxConfig(a=JSON.parse(a)),loadBox&&(loadBox.removeClass("loading"),loadText.text("正在查询...")))}).catch(function(a){loadBox.removeClass("loading"),$(".load-box").addClass("loaded"),swal({button:"关闭",text:"加载失败请再次加载"})}),wx.error(function(a){if(a){JSON.stringify(a);"config:invalid signature"===a.errMsg&&apiByObj({service:"getNewTicket",path:"/mobile/Js_interface/"}).then(function(a){a&&wxConfig(a=JSON.parse(a))}).catch(function(a){loadBox.removeClass("loading"),$(".load-box").addClass("loaded"),swal({button:"关闭",text:"加载失败请再次加载"})}),"config:invalid url domain"===a.errMsg&&(loadBox.removeClass("loading"),$(".load-box").addClass("loaded"),swal({button:"关闭",text:"加载失败请再次加载"}))}}),wx.ready(function(){loadBox&&(loadBox.removeClass("loading"),$(".load-box").addClass("loaded"))});